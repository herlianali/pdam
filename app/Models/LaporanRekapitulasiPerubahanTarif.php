<?php

namespace App\Models;

use Illuminate\Database\Eloquent\Factories\HasFactory;
use Illuminate\Database\Eloquent\Model;
use Illuminate\Support\Facades\DB;

class LaporanRekapitulasiPerubahanTarif extends Model
{
    use HasFactory;

    public static function getPembuatan ()
    {
        return DB::select("SELECT * FROM (SELECT DECODE (a.jns_tarif, '', 'JUMLAH', a.jns_tarif) AS jenis_tarif, b.* FROM   jenis_tarif a, (SELECT DECODE (GROUPING (kd_tarif), 1, ' ', kd_tarif) AS kd_tarif, COUNT (tarif11) AS tarif11, COUNT (tarif21) AS tarif21, COUNT (tarif22) AS tarif22, COUNT (tarif23) AS tarif23, COUNT (tarif31) AS tarif31, COUNT (tarif32) AS tarif32, COUNT (tarif33) AS tarif33, COUNT (tarif34) AS tarif34, COUNT (tarif41) AS tarif41, COUNT (tarif42) AS tarif42, COUNT (tarif43) AS tarif43, COUNT (tarif44) AS tarif44, COUNT (tarif51) AS tarif51, COUNT (tarif53) AS tarif53, SUM (jumlah_bln_ini) AS jumlah_bln_ini, SUM (jumlah_sd_bln_ini) AS jumlah_sd_bln_ini, SUM (jumlah_bln_lalu) AS jumlah_bln_lalu, SUM (jumlah_sd_bln_lalu) AS jumlah_sd_bln_lalu, SUM (jumlah_mutasi_alamat) AS jumlah_mutasi_alamat FROM (SELECT b.jns_tarif, b.kd_tarif, (SELECT sum(c.tarif11) FROM   ba_mutasi WHERE  TO_CHAR (c.tgl_bamutasi,'yyyy/mm') = '" & Format(mskPeriode.Text, "yyyy/mm") & "' AND c.kd_tarif = ba_mutasi.kd_tarif_l ) AS tarif11, (SELECT sum(c.tarif21) FROM   ba_mutasi WHERE  TO_CHAR (c.tgl_bamutasi,'yyyy/mm') = '" & Format(mskPeriode.Text, "yyyy/mm") & "' AND c.kd_tarif = ba_mutasi.kd_tarif_l ) AS tarif21, (SELECT sum(c.tarif22) FROM   ba_mutasi WHERE  TO_CHAR (c.tgl_bamutasi,'yyyy/mm') = '" & Format(mskPeriode.Text, "yyyy/mm") & "' AND c.kd_tarif = ba_mutasi.kd_tarif_l ) AS tarif22, (SELECT sum(c.tarif23) FROM ba_mutasi WHERE  TO_CHAR (c.tgl_bamutasi,'yyyy/mm') = '" & Format(mskPeriode.Text, "yyyy/mm") & "' AND c.kd_tarif = ba_mutasi.kd_tarif_l ) AS tarif23, (SELECT sum(c.tarif31) FROM   ba_mutasi WHERE  TO_CHAR (c.tgl_bamutasi,'yyyy/mm') = '" & Format(mskPeriode.Text, "yyyy/mm") & "' AND c.kd_tarif = ba_mutasi.kd_tarif_l ) AS tarif31, (SELECT sum(c.tarif32) FROM   ba_mutasi WHERE  TO_CHAR (c.tgl_bamutasi,'yyyy/mm') = '" & Format(mskPeriode.Text, "yyyy/mm") & "' AND c.kd_tarif = ba_mutasi.kd_tarif_l ) AS tarif32, (SELECT sum(c.tarif33) FROM ba_mutasi WHERE  TO_CHAR (c.tgl_bamutasi,'yyyy/mm') = '" & Format(mskPeriode.Text, "yyyy/mm") & "' AND c.kd_tarif = ba_mutasi.kd_tarif_l ) AS tarif33, (SELECT sum(c.tarif34) FROM   ba_mutasi WHERE  TO_CHAR (c.tgl_bamutasi,'yyyy/mm') = '" & Format(mskPeriode.Text, "yyyy/mm") & "' AND c.kd_tarif = ba_mutasi.kd_tarif_l ) AS tarif34, (SELECT sum(c.tarif41) FROM ba_mutasi WHERE  TO_CHAR (c.tgl_bamutasi,'yyyy/mm') = '" & Format(mskPeriode.Text, "yyyy/mm") & "' AND c.kd_tarif = ba_mutasi.kd_tarif_l ) AS tarif41, (SELECT sum(c.tarif42) FROM ba_mutasi WHERE TO_CHAR (c.tgl_bamutasi,'yyyy/mm') = '" & Format(mskPeriode.Text, "yyyy/mm") & "' AND c.kd_tarif =ba_mutasi.kd_tarif_l ) AS tarif42, (SELECT sum(c.tarif43) FROM   ba_mutasi WHERE  TO_CHAR (c.tgl_bamutasi,'yyyy/mm') = '" & Format(mskPeriode.Text, "yyyy/mm") & "' AND c.kd_tarif = ba_mutasi.kd_tarif_l ) AS tarif43, (SELECT sum(c.tarif44) FROM   ba_mutasi WHERE  TO_CHAR (c.tgl_bamutasi,'yyyy/mm') = '" & Format(mskPeriode.Text, "yyyy/mm") & "' AND c.kd_tarif = ba_mutasi.kd_tarif_l ) AS tarif44, (SELECT sum(c.tarif51) FROM   ba_mutasi WHERE  TO_CHAR (c.tgl_bamutasi,'yyyy/mm') = '" & Format(mskPeriode.Text, "yyyy/mm") & "' AND c.kd_tarif = ba_mutasi.kd_tarif_l ) AS tarif51, (SELECT sum(c.tarif53) FROM   ba_mutasi WHERE  TO_CHAR (c.tgl_bamutasi,'yyyy/mm') = '" & Format(mskPeriode.Text, "yyyy/mm") & "' AND c.kd_tarif = ba_mutasi.kd_tarif_l ) AS tarif53, (SELECT COUNT (kd_tarif) FROM   jenis_tarif WHERE  TO_CHAR (c.tgl_bamutasi,'yyyy/mm') = '" & Format(mskPeriode.Text, "yyyy/mm") & "' AND c.kd_tarif = jenis_tarif.kd_tarif ) AS jumlah_bln_ini, (SELECT COUNT (kd_tarif) FROM   jenis_tarif WHERE  TO_CHAR (c.tgl_bamutasi, 'yyyy/mm') <= '" & Format(mskPeriode.Text, "yyyy/mm") & "' AND c.kd_tarif = jenis_tarif.kd_tarif ) AS jumlah_sd_bln_ini, (SELECT COUNT (kd_tarif) FROM   jenis_tarif WHERE  TO_CHAR (c.tgl_bamutasi, 'yyyy/mm') =  TO_CHAR (ADD_MONTHS (TO_DATE ('" & Format(mskPeriode.Text, "yyyy/mm") & "','yyyy/mm'),-1),'yyyy/mm') AND c.kd_tarif = jenis_tarif.kd_tarif ) AS jumlah_bln_lalu, (SELECT COUNT (kd_tarif) FROM   jenis_tarif WHERE  TO_CHAR (c.tgl_bamutasi, 'yyyy/mm') <=TO_CHAR (ADD_MONTHS (TO_DATE ('" & Format(mskPeriode.Text, "yyyy/mm") & "','yyyy/mm'),-1),'yyyy/mm') AND c.kd_tarif = jenis_tarif.kd_tarif ) AS jumlah_sd_bln_lalu, (SELECT COUNT (jns_mutasi) FROM   ba_mutasi WHERE  TO_CHAR (tgl_bamutasi, 'yyyy/mm')= '" & Format(mskPeriode.Text, "yyyy/mm") & "' AND c.kd_tarif = ba_mutasi.kd_tarif_l AND jns_mutasi like '%B%' ) AS jumlah_mutasi_alamat FROM jenis_tarif b, (SELECT a.tgl_bamutasi, b.kd_tarif, SUM(DECODE (TRIM (a.kd_tarif_b),'11', 1)) AS tarif11, SUM(DECODE (TRIM (a.kd_tarif_b),'21', 1)) AS tarif21, SUM(DECODE (TRIM (a.kd_tarif_b),'22', 1)) AS tarif22, SUM(DECODE (TRIM (a.kd_tarif_b),'23', 1)) AS tarif23, SUM(DECODE (TRIM (a.kd_tarif_b),'31', 1)) AS tarif31, SUM(DECODE (TRIM (a.kd_tarif_b),'32', 1)) AS tarif32, SUM(DECODE (TRIM (a.kd_tarif_b),'33', 1)) AS tarif33, SUM(DECODE (TRIM (a.kd_tarif_b),'34', 1)) AS tarif34, SUM(DECODE (TRIM (a.kd_tarif_b),'41', 1)) AS tarif41, SUM(DECODE (TRIM (a.kd_tarif_b),'42', 1)) AS tarif42, SUM(DECODE (TRIM (a.kd_tarif_b),'43', 1)) AS tarif43, SUM(DECODE (TRIM (a.kd_tarif_b),'44', 1)) AS tarif44, SUM(DECODE (TRIM (a.kd_tarif_b),'51', 1)) AS tarif51, SUM(DECODE (TRIM (a.kd_tarif_b),'53', 1)) AS tarif53 FROM   ba_mutasi a, jenis_tarif b, dil d, zona z, wilayah_dist w WHERE  a.kd_tarif_l(+) = b.kd_tarif AND a.no_plg = d.no_plg(+) AND d.zona = z.zona(+) AND z.kd_wilayah = w.kd_wilayah(+) AND w.kd_wilayah = '" & Left(cmbWilayah.Text, 1) & "' and a.FLAG_UBAHTARIF<>'T' and a.FLAG_UBAHTARIF is not null AND a.jns_mutasi LIKE '%D%' GROUP BY a.tgl_bamutasi,b.kd_tarif,a.kd_tarif_b) c WHERE c.kd_tarif(+) = b.kd_tarif) GROUP BY cube (kd_tarif)) b WHERE a.kd_tarif(+) = b.kd_tarif) WHERE jenis_tarif = 'JUMLAH'");
    }
}
